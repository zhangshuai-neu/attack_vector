#ifndef STM32F407_H__
#define STM32F407_H__

#include <stdint.h>

#define PERIPH_BASE		0x40000000U
#define AHB1PERIPH_BASE	(PERIPH_BASE + 0x00020000U)

#define GPIOA_BASE		(AHB1PERIPH_BASE + 0x0000U)
#define GPIOA_BASE		(AHB1PERIPH_BASE + 0x0000U)
#define GPIOB_BASE		(AHB1PERIPH_BASE + 0x0400U)
#define GPIOC_BASE		(AHB1PERIPH_BASE + 0x0800U)
#define GPIOD_BASE		(AHB1PERIPH_BASE + 0x0C00U)
#define GPIOE_BASE		(AHB1PERIPH_BASE + 0x1000U)
#define GPIOF_BASE		(AHB1PERIPH_BASE + 0x1400U)
#define GPIOG_BASE		(AHB1PERIPH_BASE + 0x1800U)
#define GPIOH_BASE		(AHB1PERIPH_BASE + 0x1C00U)
#define GPIOI_BASE		(AHB1PERIPH_BASE + 0x2000U)

#define MPU_BASE		(0xe000ed90U)

#define MMAP_WORD(base, offset) \
		(*(volatile uint32_t*)((base) + (offset)))

#define GPIOA_MODER		MMAP_WORD(GPIOA_BASE, 0x00U)
#define GPIOA_OTYPER	MMAP_WORD(GPIOA_BASE, 0x04U)
#define GPIOA_OSPEEDR	MMAP_WORD(GPIOA_BASE, 0x08U)
#define GPIOA_PUPDR		MMAP_WORD(GPIOA_BASE, 0x0cU)
#define GPIOA_IDR		MMAP_WORD(GPIOA_BASE, 0x10U)
#define GPIOA_ODR		MMAP_WORD(GPIOA_BASE, 0x14U)
#define GPIOA_BSRR		MMAP_WORD(GPIOA_BASE, 0x18U)
#define GPIOA_LCKR		MMAP_WORD(GPIOA_BASE, 0x1cU)
#define GPIOA_AFRL		MMAP_WORD(GPIOA_BASE, 0x20U)
#define GPIOA_AFRH		MMAP_WORD(GPIOA_BASE, 0x24U)

#define GPIOD_MODER		MMAP_WORD(GPIOD_BASE, 0x00U)
#define GPIOD_OTYPER	MMAP_WORD(GPIOD_BASE, 0x04U)
#define GPIOD_OSPEEDR	MMAP_WORD(GPIOD_BASE, 0x08U)
#define GPIOD_PUPDR		MMAP_WORD(GPIOD_BASE, 0x0cU)
#define GPIOD_IDR		MMAP_WORD(GPIOD_BASE, 0x10U)
#define GPIOD_ODR		MMAP_WORD(GPIOD_BASE, 0x14U)
#define GPIOD_BSRR		MMAP_WORD(GPIOD_BASE, 0x18U)
#define GPIOD_LCKR		MMAP_WORD(GPIOD_BASE, 0x1cU)
#define GPIOD_AFRL		MMAP_WORD(GPIOD_BASE, 0x20U)
#define GPIOD_AFRH		MMAP_WORD(GPIOD_BASE, 0x24U)

#define MPU_TYPE		MMAP_WORD(MPU_BASE, 0x00U)
#define MPU_CTRL		MMAP_WORD(MPU_BASE, 0x04U)
#define MPU_RNR			MMAP_WORD(MPU_BASE, 0x08U)
#define MPU_RBAR		MMAP_WORD(MPU_BASE, 0x0cU)
#define MPU_RASR		MMAP_WORD(MPU_BASE, 0x10U)
#define MPU_RBAR_A1		MMAP_WORD(MPU_BASE, 0x14U)
#define MPU_RASR_A1		MMAP_WORD(MPU_BASE, 0x18U)
#define MPU_RBAR_A2		MMAP_WORD(MPU_BASE, 0x1cU)
#define MPU_RASR_A2		MMAP_WORD(MPU_BASE, 0x20U)
#define MPU_RBAR_A3		MMAP_WORD(MPU_BASE, 0x24U)
#define MPU_RASR_A3		MMAP_WORD(MPU_BASE, 0x28U)

#define SET_OUT(x)		(1U << ((x) << 1))

#define MPU_REG_ENABLE	1U
#define MPU_REG_SIZE_32B	(0b00100U << 1)
#define MPU_REG_SIZE_64B	(0b00101U << 1)
#define MPU_REG_SIZE_128B	(0b00110U << 1)
#define MPU_REG_SIZE_256B	(0b00111U << 1)
#define MPU_REG_SIZE_512B	(0b01000U << 1)
#define MPU_REG_SIZE_1KB	(0b01001U << 1)
#define MPU_REG_SIZE_2KB	(0b01010U << 1)
#define MPU_REG_SIZE_4KB	(0b01011U << 1)
#define MPU_REG_SIZE_8KB	(0b01100U << 1)
#define MPU_REG_SIZE_16KB	(0b01110U << 1)

#define MPU_REG_SIZE_4GB	(0b11111U << 1)

#define MPU_REG_BUFFERABLE	(1U << 16)
#define MPU_REG_CACHEABLE	(1U << 17)
#define MPU_REG_SHAREABLE	(1U << 18)

#define MPU_AP_RWRW		(0b011U << 24)
#define MPU_AP_RWNA		(0b001U << 24)

#endif
